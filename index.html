<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Memory Flip Game PRO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.dark {
            background: #111;
            color: #fff
        }

        .container {
            background: #fff;
            padding: 20px;
            border-radius: 14px;
            width: 100%;
            max-width: 900px;
        }

        body.dark .container {
            background: #222
        }

        h1 {
            text-align: center;
            margin-bottom: 10px
        }

        .menu,
        .game {
            display: none
        }

        .menu.active,
        .game.active {
            display: block
        }

        .controls {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .scoreboard div {
            display: inline-block;
            background: #667eea;
            color: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            margin-right: 6px;
        }

        button,
        select {
            padding: 7px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .card {
            position: relative;
            padding-top: 100%;
            perspective: 800px;
        }

        .inner {
            position: absolute;
            inset: 0;
            transition: 0.5s;
            transform-style: preserve-3d;
        }

        .card.flipped .inner {
            transform: rotateY(180deg)
        }

        .front,
        .back {
            position: absolute;
            inset: 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            backface-visibility: hidden;
        }

        .front {
            background: #ddd
        }

        .back {
            background: #667eea;
            color: #fff;
            transform: rotateY(180deg)
        }

        .card.matched .inner {
            outline: 3px solid #4ECDC4;
            box-shadow: 0 0 15px #4ECDC4;
        }

        .card.wrong {
            animation: shake .4s
        }

        @keyframes shake {
            0% {
                transform: translateX(0)
            }

            25% {
                transform: translateX(-5px)
            }

            50% {
                transform: translateX(5px)
            }

            75% {
                transform: translateX(-3px)
            }

            100% {
                transform: translateX(0)
            }
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .75);
            display: none;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-align: center;
        }

        .overlay.visible {
            display: flex
        }

        .overlay-box {
            background: #222;
            padding: 20px;
            border-radius: 12px;
        }

        .overlay-box button {
            margin: 5px
        }

        @media(max-width:768px) {
            .board {
                grid-template-columns: repeat(4, 1fr)
            }
        }

        .game.paused {
            opacity: 0.5;
            pointer-events: none;
        }

        button.disabled {
            text-decoration: line-through;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }



        #welcomeText {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 2px;
        }
    </style>
</head>

<body>

    <div class="container">

        <!-- MENU -->
        <div class="menu active" id="menu">
            <h1>üÉè Memory Flip Game</h1>
            <p style="text-align:center;margin-bottom:10px">Train your brain!</p>

            <div style="text-align:center">
                <input id="playerName" type="text" placeholder="Enter your name" required><br><br>

                <input id="playerAge" type="number" placeholder="Age" min="1"><br><br>

                <select id="playerGender">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select><br><br>

                <select id="difficulty">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                </select><br><br>
                <button id="startGame">‚ñ∂ Start Game</button>
                <button id="darkBtn">üåô Dark Mode</button>
                <button onclick="openHistory()">üìú Game History</button>
                <button onclick="clearHistory()">üóë Clear History</button>
                



            </div>
        </div>
        <div class="menu" id="historyPage">
    <h1>üèÜ Leaderboards</h1>

    <h2>üü¢ Easy</h2>
    <div id="easyBoard"></div>

    <h2>üü° Medium</h2>
    <div id="mediumBoard"></div>

    <h2>üî¥ Hard</h2>
    <div id="hardBoard"></div>

    <br>
    <button onclick="backToMenu()">‚¨Ö Back</button>
</div>



        <!-- GAME -->
        <div class="game" id="game">
            <div class="controls">
                <h2 id="welcomeText"></h2>

                <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;">
                    <div class="scoreboard">
                        <div>Moves: <span id="moves">0</span></div>
                        <div>Pairs: <span id="pairs">0</span></div>
                        <div>Time: <span id="time">60</span></div>
                        <div>Hints: <span id="hints">2</span></div>
                        <div>Level: <span id="level"></span></div>
                        <div>Best: <span id="best"></span></div>
                    </div>

                    <div>
                        <button id="hintBtn">üí° Hint</button>
                        <button id="pauseBtn">‚è∏</button>
                    </div>
                </div>
            </div>

            <div class="board" id="board"></div>
        </div>

    </div>

    <div class="overlay" id="overlay">
        <div class="overlay-box" id="overlayBox"></div>
    </div>


    <script>

        /* ---------------- SETTINGS (LocalStorage) ---------------- */
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark");
        }

        const savedDiff = localStorage.getItem("lastDifficulty");
        if (savedDiff) difficulty.value = savedDiff;



        /* ---------------- DATA ---------------- */
        const emojis = {
            easy: ['üçé', 'üçå', 'üçá', 'üçì', 'üçâ', 'üçç'],
            medium: ['üê∂', 'üê±', 'üêº', 'ü¶ä', 'üê∏', 'üêµ', 'ü¶Å', 'üêØ', 'üêª'],
            hard: ['‚öΩ', 'üèÄ', 'üèà', 'üéæ', 'üé±', 'üèê', 'üèì', 'ü•ä', 'ü•ã', '‚õ≥', 'üè∏', '‚öæ']
        };

        /* ---------------- STATE ---------------- */
        let first = null, second = null, busy = false;
        let moves = 0, pairs = 0, time = 60, timer;
        let hintLeft = 2, paused = false, values = [];
        let currentPlayer = null;
        let totalHints = 0;
        window.addEventListener("load", () => {
            const gameActive = localStorage.getItem("gameActive") === "true";
            const savedPlayer = JSON.parse(localStorage.getItem("currentPlayer"));

            if (gameActive && savedPlayer) {
                currentPlayer = savedPlayer;
                playerName.value = savedPlayer.name;
                playerAge.value = savedPlayer.age;
                playerGender.value = savedPlayer.gender;

                menu.classList.remove("active");
                game.classList.add("active");
                init();
            } else {
                localStorage.removeItem("currentPlayer");
                playerName.value = "";
                playerAge.value = "";
                playerGender.value = "";
            }
        });





        /* ---------------- DOM ---------------- */
        const board = document.getElementById("board");
        const movesEl = document.getElementById("moves");
        const pairsEl = document.getElementById("pairs");
        const timeEl = document.getElementById("time");
        const hintsEl = document.getElementById("hints");
        const overlay = document.getElementById("overlay");
        const overlayBox = document.getElementById("overlayBox");

        /* ---------------- EVENT DELEGATION ---------------- */
        board.addEventListener("click", (e) => {
            const card = e.target.closest(".card");
            if (!card) return;
            clickCard(card);
        });


        /* ---------------- GAME START ---------------- */
       startGame.onclick = () => {

    const name = playerName.value.trim();
    const age = playerAge.value;
    const gender = playerGender.value;

    let errors = [];

    if (!name) {
        errors.push("‚Ä¢ Please fill your Name");
    }

    if (!age) {
        errors.push("‚Ä¢ Please enter your Age");
    }

    if (!gender) {
        errors.push("‚Ä¢ Please select your Gender");
    }

    
    if (errors.length > 0) {
        alert(errors.join("\n"));
        return;
    }

    currentPlayer = { name, age, gender };
    localStorage.setItem("currentPlayer", JSON.stringify(currentPlayer));
    localStorage.setItem("gameActive", "true");

    welcomeText.textContent = `HELLO ${name.toUpperCase()} üëã`;

    localStorage.setItem("lastDifficulty", difficulty.value);

    menu.classList.remove("active");
    game.classList.add("active");

    init();
    showTempMessage("üéÆ Game Started", 1000);
};


        /* ---------------- INIT ---------------- */
        function init() {
            board.innerHTML = "";
            moves = pairs = 0;

            paused = false;
            pauseBtn.textContent = "‚è∏";

            const diff = difficulty.value;

            // ----- HINTS PER DIFFICULTY -----
            if (diff === "easy") hintLeft = 1;
            else if (diff === "medium") hintLeft = 2;
            else hintLeft = 3;

            totalHints = hintLeft;
            hintsEl.textContent = hintLeft;
            hintBtn.classList.remove("disabled");

            // ----- BEST SCORE PER DIFFICULTY -----
            const bestKey = `bestScore_${diff}`;
            const bestScore = localStorage.getItem(bestKey);

            document.getElementById("level").textContent = diff;
            document.getElementById("best").textContent = bestScore ?? "-";

            // ----- BOARD SETUP -----
            values = [];
            emojis[diff].forEach(e => values.push(e, e));

            time = diff === "easy" ? 30 : diff === "medium" ? 60 : 90;

            shuffle(values).forEach(v => board.appendChild(card(v)));

            updateUI();
            startTimer();
        }



        /* ---------------- CARD ---------------- */
        function card(v) {
            const c = document.createElement("div");
            c.className = "card";
            c.dataset.v = v;
            c.innerHTML = `<div class="inner"><div class="front"></div><div class="back">${v}</div></div>`;
            return c;
        }

        /* ---------------- CLICK ---------------- */
        function clickCard(c) {
            if (busy || paused || c === first || c.classList.contains("matched")) return;
            c.classList.add("flipped");

            if (!first) { first = c; return; }
            second = c; busy = true; moves++; updateUI();
            if (first.dataset.v === second.dataset.v) {
                first.classList.add("matched");
                second.classList.add("matched");
                pairs++;
                updateUI();

                setTimeout(() => {
                    reset();
                    if (pairs === values.length / 2) {
                        win();
                    }
                }, 400);
            }
            else {
                setTimeout(() => {
                    first.classList.remove("flipped");
                    second.classList.remove("flipped");
                    reset();
                }, 700);
            }
        }
        function reset() { first = second = null; busy = false }

        /* ---------------- TIMER ---------------- */
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                if (!paused) {
                    time--; updateUI();
                    if (time <= 0) lose();
                }
            }, 1000);
        }

        hintBtn.onclick = () => {

            if (hintLeft <= 0) {
                showTempMessage("‚ùå Hint not available");
                return;
            }

            if (paused) return;

            hintLeft--;
            hintsEl.textContent = hintLeft;

            document.querySelectorAll(".card").forEach(c =>
                c.classList.add("flipped")
            );

            setTimeout(() => {
                document.querySelectorAll(".card").forEach(c => {

                    if (c.classList.contains("matched")) return;

                    if (c === first) return;

                    c.classList.remove("flipped");
                });

                busy = false;
                second = null;

                if (hintLeft === 0) {
                    hintBtn.classList.add("disabled");
                }

            }, 1000);
        };

        function showOverlay(msg) {
            overlayBox.innerHTML = `<h2>${msg}</h2>`;
            overlay.classList.add("visible");
        }

        function hideOverlay() {
            overlay.classList.remove("visible");
        }

        function showTempMessage(msg, duration = 800) {
            overlayBox.innerHTML = `<h2>${msg}</h2>`;
            overlay.classList.add("visible");

            setTimeout(() => {
                overlay.classList.remove("visible");
            }, duration);
        }

        function pauseGame() {
            paused = true;
            pauseBtn.textContent = "‚ñ∂";

            overlayBox.innerHTML = `
        <h2>‚è∏ Game Paused</h2>
        <p>Press <b>R</b> to Resume or click Resume</p>

        <button id="resumeBtn">‚ñ∂ Resume</button>
        <button id="restartBtn">üîÅ Restart</button>
        <button id="quitBtn">‚ùå Quit</button>
    `;

            overlay.classList.add("visible");

            document.getElementById("resumeBtn").onclick = resumeGame;

            document.getElementById("restartBtn").onclick = () => {
                overlay.classList.remove("visible");
                init();
            };

            document.getElementById("quitBtn").onclick = () => backMenu(true);

        }



        function resumeGame() {
            paused = false;
            pauseBtn.textContent = "‚è∏";
            overlay.classList.remove("visible");

            overlayBox.innerHTML = `<h2>‚ñ∂ Game Resumed</h2>`;
            overlay.classList.add("visible");
            setTimeout(() => overlay.classList.remove("visible"), 700);
        }


        /* ---------------- PAUSE ---------------- */
        pauseBtn.onclick = () => {
            if (!paused) {
                pauseGame();
            } else {
                resumeGame();
            }
        };






        /* ---------------- KEYBOARD EVENTS ---------------- */
        document.addEventListener("keydown", (e) => {
            if (!game.classList.contains("active")) return;

            if ((e.key === "p" || e.key === "P") && !paused) {
                pauseBtn.click();
            }

            if ((e.key === "r" || e.key === "R") && paused) {
                pauseBtn.click();
            }

            if (e.key === "h" || e.key === "H") {
                hintBtn.click();
            }

            // üëá ADD THIS
            if (e.key === "q" || e.key === "Q") {
                backMenu(true);
            }

        });


        function saveToHistory() {
            if (!currentPlayer) return;

            const history = JSON.parse(localStorage.getItem("gameHistory")) || [];

            history.push({
                name: currentPlayer.name,
                age: currentPlayer.age,
                gender: currentPlayer.gender,
                difficulty: difficulty.value,
                moves,
                pairsFormed: pairs,
                hintsUsed: totalHints - hintLeft,
                result: currentPlayer.lastResult,
                darkMode: document.body.classList.contains("dark"),
                date: new Date().toISOString()
            });

            localStorage.setItem("gameHistory", JSON.stringify(history));
        }



        /* ---------------- END ---------------- */
        function win() {
            clearInterval(timer);

            const diff = difficulty.value;
            const bestKey = `bestScore_${diff}`;
            let bestScore = localStorage.getItem(bestKey);

            if (!bestScore || moves < bestScore) {
                bestScore = moves;
                localStorage.setItem(bestKey, bestScore);
            }


            showEnd(`
üéâ YOU WON!<br>
üß† Well Played!<br><br>
Moves: ${moves}<br>
Pairs Formed: ${pairs}<br>
Hints Used: ${totalHints - hintLeft}<br>
üèÜ Best Score (${diff}): ${bestScore}
`);

            currentPlayer = {
                ...currentPlayer,
                difficulty: difficulty.value,
                darkMode: document.body.classList.contains("dark"),
                lastResult: "WIN",
                moves: moves,
                pairsFormed: pairs,
                hintsUsed: totalHints - hintLeft
            };

            localStorage.setItem("currentPlayer", JSON.stringify(currentPlayer));

            saveToHistory();
        }





        function lose() {
            clearInterval(timer);

            showEnd(`
üòû Better luck next time!<br>
‚è∞ Time‚Äôs up<br><br>
Moves: ${moves}<br>
Pairs Formed: ${pairs}<br>
Hints Used: ${totalHints - hintLeft}<br>
`);
            currentPlayer = {
                ...currentPlayer,
                difficulty: difficulty.value,
                darkMode: document.body.classList.contains("dark"),
                lastResult: "LOSE",
                moves: moves,
                pairsFormed: pairs,
                hintsUsed: totalHints - hintLeft
            };

            localStorage.setItem("currentPlayer", JSON.stringify(currentPlayer));

            saveToHistory();


        }


        function showEnd(msg) {
            overlayBox.innerHTML = `
        <h2>${msg}</h2><br>
        <button onclick="restart()">üîÅ Play Again</button>
        <button onclick="backMenu()">üè† Main Menu</button>`;
            overlay.classList.add("visible");

        }

        /* ---------------- NAV ---------------- */
        function restart() {
            overlay.classList.remove("visible");
            init();
        }
        function backMenu(fromQuit = false) {
            if (fromQuit) {
                const confirmQuit = confirm("‚ö† Your current game will be lost. Quit game?");
                if (!confirmQuit) return;
            }

            overlay.classList.remove("visible");
            game.classList.remove("active");
            menu.classList.add("active");

            localStorage.removeItem("gameActive");
            localStorage.removeItem("currentPlayer");

            playerName.value = "";
            playerAge.value = "";
            playerGender.value = "";
            currentPlayer = null;
        }

        function saveCurrentPlayerLive() {
            if (!playerName.value || !playerAge.value || !playerGender.value) return;

            currentPlayer = {
                ...(currentPlayer || {}),
                name: playerName.value.trim(),
                age: playerAge.value,
                gender: playerGender.value
            };

            localStorage.setItem("currentPlayer", JSON.stringify(currentPlayer));
        }


        playerName.addEventListener("input", saveCurrentPlayerLive);
        playerAge.addEventListener("input", saveCurrentPlayerLive);
        playerGender.addEventListener("change", saveCurrentPlayerLive);




        /* ---------------- UTILS ---------------- */
        function updateUI() {
            movesEl.textContent = moves;
            pairsEl.textContent = pairs;
            timeEl.textContent = time;
        }
        function shuffle(a) { return a.sort(() => Math.random() - 0.5) }

        darkBtn.onclick = () => {
            document.body.classList.toggle("dark");
            localStorage.setItem("darkMode", document.body.classList.contains("dark"));
        };

     function openHistory() {
    menu.classList.remove("active");
    game.classList.remove("active");
    historyPage.classList.add("active");

    const history = JSON.parse(localStorage.getItem("gameHistory")) || [];

    renderLeaderboard("easy", history, document.getElementById("easyBoard"));
    renderLeaderboard("medium", history, document.getElementById("mediumBoard"));
    renderLeaderboard("hard", history, document.getElementById("hardBoard"));
}


function renderLeaderboard(level, history, container) {
    let data = history.filter(h => h.difficulty === level);

    if (data.length === 0) {
        container.innerHTML = `
            <p style="
                text-align:center;
                color:#999;
                margin:10px 0;
                font-size:16px;
            ">
                üö´ No games played yet
            </p>
        `;
        return;
    }

    // üèÜ SORT RULES
    const wins = data.filter(h => h.result === "WIN")
                     .sort((a, b) => a.moves - b.moves);

    const loses = data.filter(h => h.result === "LOSE")
                      .sort((a, b) => {
                          if (b.pairsFormed !== a.pairsFormed) {
                              return b.pairsFormed - a.pairsFormed;
                          }
                          return a.moves - b.moves;
                      });

    const leaderboard = [...wins, ...loses];

    container.innerHTML = leaderboard.map((h, i) => `
        <div style="
            background:${h.result === "WIN"
                ? "linear-gradient(135deg,#4ECDC4,#1ABC9C)"
                : "linear-gradient(135deg,#FF6B6B,#C0392B)"};
            color:white;
            padding:12px;
            margin:8px 0;
            border-radius:10px;
        ">
            <b>#${i + 1} ${h.name}</b> (${h.age}, ${h.gender})<br>
            Result: <b>${h.result}</b><br>
            Moves: ${h.moves} | Pairs: ${h.pairsFormed}<br>
            <small>${new Date(h.date).toLocaleString()}</small>
        </div>
    `).join("");
}



        function backToMenu() {
            historyPage.classList.remove("active");
            menu.classList.add("active");
        }



        function clearHistory() {
            if (!confirm("Delete all game history?")) return;

            localStorage.removeItem("gameHistory");

            alert("History cleared ‚úÖ");
        }

    </script>

</body>

</html>
